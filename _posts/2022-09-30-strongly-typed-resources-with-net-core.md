---
layout: post
title: "Generate Strongly-Typed Resources with .NET Core"
date: 2022-09-30 -0800
comments: true
tags: [net,csharp,vs]
description: "Visual Studio automatically handles generating strongly-typed resources (*.Designer.cs from *.resx) but that doesn't work from VS Code or just the dotnet CLI. Here's how to fix it."
---

In the not-too-distant past I switched from using Visual Studio for my full-time .NET IDE to using VS Code. No, it doesn't give me quite as much fancy stuff, but it feels a lot faster and it's nice to not have to switch to different editors for different languages.

Something I noticed, though, was that if I updated my `*.resx` files in VS Code, the associated `*.Designer.cs` was not getting auto-generated. There is [a GitHub issue for this](https://github.com/dotnet/msbuild/issues/4751) and it includes some different solutions to the issue involving some `.csproj` hackery, but it's sort of hard to parse through and find the thing that works.

Here's what we're using for Autofac, and it works for both Visual Studio and VS Code.

```xml
<Project Sdk="Microsoft.NET.Sdk">
  <PropertyGroup>
    <!--
        Target framework doesn't matter, but this solution is tested with
        .NET 6 SDK and above.
    -->
    <TargetFrameworks>net6.0</TargetFrameworks>
  </PropertyGroup>

  <ItemGroup>
    <!--
        Remove the *.Designer.cs files from the Compile element. They WILL be
        compiled, but if you don't do this, you get warnings about the files
        being included twice.

        If you have those `Compile Update` directives pointing at the designer
        files with the `DesignTime`, `AutoGen`, and `DependentUpon` entries
        that VS usually puts there by default, those have to be removed.
    -->
    <Compile Remove="**/*.Designer.cs" />

    <!--
        Here's the magic. You need to specify everything for the generated
        designer file - the filename, the language, the namespace, and the
        class name.
    -->
    <EmbeddedResource Update="MyResources.resx">
      <Generator>ResXFileCodeGenerator</Generator>
      <LastGenOutput>MyResources.Designer.cs</LastGenOutput>
      <StronglyTypedFileName>MyResources.Designer.cs</StronglyTypedFileName>
      <StronglyTypedLanguage>CSharp</StronglyTypedLanguage>
      <StronglyTypedNamespace>Your.Project.Namespace</StronglyTypedNamespace>
      <StronglyTypedClassName>MyResources</StronglyTypedClassName>
    </EmbeddedResource>

    <!--
        If you have resources in a child folder it still works, but you need to
        make sure you update the StronglyTypedFileName AND the
        StronglyTypedNamespace.
    -->
    <EmbeddedResource Update="Some\Sub\Folder\OtherResources.resx">
      <Generator>ResXFileCodeGenerator</Generator>
      <LastGenOutput>OtherResources.Designer.cs</LastGenOutput>
      <StronglyTypedFileName>Some\Sub\Folder\OtherResources.Designer.cs</StronglyTypedFileName>
      <StronglyTypedLanguage>CSharp</StronglyTypedLanguage>
      <StronglyTypedNamespace>Your.Project.Namespace.Some.Sub.Folder</StronglyTypedNamespace>
      <StronglyTypedClassName>OtherResources</StronglyTypedClassName>
    </EmbeddedResource>
  </ItemGroup>
</Project>
```

Additional tips:

Once you have this in place, you can `.gitignore` any `*.Designer.cs` files and remove them from source. They'll be regenerated by the build, but if you leave them checked in then the version of the generator that Visual Studio uses will fight with the version of the generator that the CLI build uses and you'll get constant changes. The substance of the generated code is the same, but file headers may be different.

You can use [VS Code file nesting](https://code.visualstudio.com/updates/v1_67#_explorer-file-nesting) to nest the `*.Designer.cs` files under the `*.resx` files with this config:

```json
{
  "explorer.fileNesting.enabled": true,
  "explorer.fileNesting.patterns": {
    "*.resx": "$(capture).*.resx, $(capture).designer.cs, $(capture).designer.vb"
  }
}
```
